var fleximeta=fleximeta||{version:"0.1.0"};fleximeta.editor=fleximeta.editor||{};fleximeta.model=fleximeta.editor||{};fleximeta.views=fleximeta.views||{};fleximeta.prettify=fleximeta.prettify||{};(function(){fleximeta.Serializer={};fleximeta.Serializer.serialize=function(d,c){c=c||{};var b=[],a=c.indent||0,f=c.prettify||false;var e=JSON.stringify(d,function(g,h){if(typeof h==="object"&&h!==null&&h.getUuid){if(b.indexOf(h.getUuid())!==-1){return h.getUuid()}b.push(h.getUuid())}return h},a);b=null;if(f){e=fleximeta.prettify.json.prettyPrint(e)}return e};fleximeta.Serializer.deserialize=function(c,a){a=a||{};var b=a.baseClass||fleximeta.model.Base;return new b(c)}})();(function(){fleximeta.views.JsonExporter=function(a){a=a||{};var d=a.element,c=document.createElement("pre"),b=document.createElement("code");this.model=a.model;c.innerHTML="<a href=''><span style='float:right'class='glyphicon glyphicon-cog'></span></a>";c.innerHTML+="<a href=''><span style='float:right'class='glyphicon glyphicon-repeat'></span></a>";c.innerHTML+="<a href=''><span style='float:right'class='glyphicon glyphicon-question-sign'></span></a>";c.innerHTML+="<strong>JSON Output:</strong><br /><br />";c.appendChild(b);d.appendChild(c);this.codeElement=b;this.setTimer(5000)};fleximeta.views.JsonExporter.prototype.setTimer=function(a){if(this.timerId){this.timerId.clearInterval(this.timerId)}this.refresh();this.timerId=setInterval(this.refresh.bind(this),a)};fleximeta.views.JsonExporter.prototype.refresh=function(){this.codeElement.innerHTML=fleximeta.Serializer.serialize(this.model,{indent:3,prettify:true})}})();(function(){fleximeta.views.XmlExporter=function(b){b=b||{};this.element=b.element;var e=b.element,d=document.createElement("pre"),c=document.createElement("code");this.model=b.model;this.phase=b.phase||0;d.innerHTML="<a href=''><span style='float:right'class='glyphicon glyphicon-cog'></span></a>";d.innerHTML+="<a href=''><span style='float:right'class='glyphicon glyphicon-repeat'></span></a>";d.innerHTML+="<a href=''><span style='float:right'class='glyphicon glyphicon-question-sign'></span></a>";d.innerHTML+="<strong>XML Output:</strong><br /><br />";d.appendChild(c);e.appendChild(d);this.codeElement=c;var a='<note><to href="test">Tove</to><from>Jani</from><heading>Reminder</heading><body>Don\'t forget me this weekend!</body></note>';if(this.phase===0){this.codeElement.innerHTML="XML Export is not available during the <mark>Exploratory</mark> phase"}};fleximeta.views.XmlExporter.prototype.refresh=function(){var a;if(!this.model.toXML){return}a=this.model.toXML();this.codeElement.innerHTML=fleximeta.prettify.xml.prettyPrint(a)};fleximeta.views.XmlExporter.prototype.setTimer=function(a){this.timer=a;this.cancelTimer();this.startTimer()};fleximeta.views.XmlExporter.prototype.cancelTimer=function(){if(this.timerId){window.clearInterval(this.timer)}};fleximeta.views.XmlExporter.prototype.startTimer=function(){this.timerId=setInterval(this.refresh.bind(this),this.timer)};fleximeta.views.XmlExporter.prototype.reinitialize=function(){this.cancelTimer();this.startTimer()}})();(function(){var b=["Exploratory","Consolidation","Finalization"],c=["Validity","Flexibility","Platform independence","Model coverage","Interoperability"],d=0;var a=[{Validity:{label:"No validation is possible at this level.",mark:1},Flexibility:{label:"JavaScript objects inherit from the Base JavaScript meta-object. Therefore, they can access to the generic getter and setter defined by its prototype. No limitation to create new attributes and object references.",mark:3},"Platform independence":{label:"FlexiMeta is fully independent of any platform.",mark:3},"Model coverage":{label:"FlexiMeta provides coverage for concept, references, composition, subset, redefine, opposite relation.",mark:2},Interoperability:{label:"Interoperability is ensured by the use of the standardized JSON format. However, it is not possible to use import / export functions in a specific meta-model definition.",mark:1},},{Validity:{label:"Partial validation is possible at this level.",mark:2},Flexibility:{label:"JavaScript objects inherit from the newly created meta-objects. They can access to the specific getters and setters defined by their prototypes. However, it is still possible to access generic functions from the Base Javascript meta-object.",mark:2},"Platform independence":{label:"",mark:3},"Model coverage":{label:"",mark:2},Interoperability:{label:"Import / export functions can be generated from a specific metamodel.",mark:1},},{Validity:{label:"Full and obtrusive validation is possible at this level.",mark:3},Flexibility:{label:"JavaScript objects inherit from the newly created meta-objects. They can access to the specific getters and setters defined by their prototypes. It is no longer possible to access generic functions from the \textit{Base} Javascript meta-object.",mark:1},"Platform independence":{label:"",mark:3},"Model coverage":{label:"",mark:2},Interoperability:{label:"Import / export functions can be generated from a specific metamodel.",mark:1},},];fleximeta.views.Chart=function(j){j=j||{};a[2]["Model coverage"]=a[1]["Model coverage"]=a[0]["Model coverage"];a[2]["Platform independence"]=a[1]["Platform independence"]=a[0]["Platform independence"];var k=j.element,e=k.nextElementSibling,g=this,f=document.createElement("div"),i=document.createElement("canvas");this.nextPhaseButton=document.createElement("button");this.currentPhaseDiv=document.createElement("div");this.demo=j.demo;d=j.currentPhase||0;f.className="links";k.appendChild(f);this.currentPhaseDiv.innerHTML="Current phase: <strong>"+b[d]+"</strong>";this.nextPhaseButton.innerHTML='<span class="glyphicon glyphicon-fast-forward" aria-hidden="true"></span> <strong>'+b[d+1]+"</strong> phase";this.nextPhaseButton.className="btn btn-primary btn-s";this.currentPhaseDiv.style.textAlign="center";this.nextPhaseButton.style.display="block";this.nextPhaseButton.style.margin="auto";e.appendChild(i);e.appendChild(this.currentPhaseDiv);e.appendChild(this.nextPhaseButton);this.nextPhaseButton.addEventListener("mouseup",function(m){m.preventDefault();var l=fleximeta.Narrator.getInstance();l.createValidationModal({name:"Moving to the "+b[d+1]+" phase ?",label:"You are currently at the <mark>"+b[d]+"</mark> phase. Are you sure you want to move to the <mark>"+b[d+1]+"</mark> phase ? (Undo is not possible)",onResult:function(n){},onFinished:function(n){if(n){g.increasePhase()}}})});f.innerHTML+="<a href='' style='margin-right:5px;'><span class='glyphicon glyphicon-question-sign'></span></a>";f.innerHTML+="<a href='' style='margin-right:5px;'><span class='glyphicon glyphicon-repeat'></span></a>";f.innerHTML+="<a href='' style='margin-right:5px;'><span class='glyphicon glyphicon-cog'></span></a>";var h={labels:c,datasets:[{label:b[d]+" phase",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:c.map(function(l){return a[d][l].mark})}]};this.chart=new Chart(i.getContext("2d")).Radar(h,{responsive:true,customTooltips:function(n){var l=$("#chartjs-tooltip");if(!n){l.css({opacity:0});return}var m=n.text.split(":")[0];n.text="<strong>"+m+":</strong> "+a[d][m].label;n.yAlign="middle";n.xAlign="left";l.removeClass("above below");l.addClass(n.xAlign);l.html(n.text);var p=n.y-l.height()/2-5-n.caretPadding,o=n.x-100-12-n.caretPadding;l.css({opacity:1,left:n.chart.canvas.parentNode.parentNode.parentNode.offsetLeft+n.chart.canvas.offsetLeft+o+"px",top:+n.chart.canvas.parentNode.offsetTop+n.chart.canvas.offsetTop+p+50+"px",fontFamily:n.fontFamily,fontSize:n.fontSize,fontStyle:n.fontStyle,})}});fleximeta.views.Chart.prototype.increasePhase=function(){var m=this,l=fleximeta.Narrator.getInstance();if(d>1){return}d++;this.currentPhaseDiv.innerHTML="Current phase: <strong>"+b[d]+"</strong>";if(d<2){this.nextPhaseButton.innerHTML='<span class="glyphicon glyphicon-fast-forward" aria-hidden="true"></span> <strong>'+b[d+1]+"</strong> phase"}else{this.nextPhaseButton.setAttribute("disabled","disabled");$(this.nextPhaseButton).unbind()}this.chart.datasets[0].label=b[d]+" phase";var o=this.chart.datasets[0].points;for(var n=0;n<c.length;n++){o[n].value=a[d][c[n]].mark}this.chart.update();$.ajax({url:"ajax/user/increase",dataType:"script",success:function(p){setTimeout(function(){if(d===1){l.changeNarrator("Lisa");l.showConsolidationPhase()}else{if(d===2){l.changeNarrator("Marge");l.showFinalizationPhase()}}m.demo.reinitialize(d)},1000)}})}}})();(function(){fleximeta.views.ModelExplorer=function(c){if(fleximeta.views.ModelExplorer.getInstance()){return fleximeta.views.ModelExplorer.getInstance()}c=c||{};var d=c.element,a=d.nextElementSibling,b=document.createElement("div");this.li=a;b.className="links";d.appendChild(b);b.innerHTML+="<a href='' style='margin-right:5px;'><span class='glyphicon glyphicon-question-sign'></span></a>";b.innerHTML+="<a href='' style='margin-right:5px;'><span class='glyphicon glyphicon-repeat'></span></a>";b.innerHTML+="<a href='' style='margin-right:5px;'><span class='glyphicon glyphicon-cog'></span></a>";this.jstree=$.jstree.create($(a),{core:{check_callback:true,}});fleximeta.views.ModelExplorer.instance=this;if(c.model){this.createNode(c.model)}};fleximeta.views.ModelExplorer.prototype.createNode=function(e,a){var d;if(!a){d="#"}else{if(typeof a==="string"){d=a}else{if(typeof a==="object"&&a.getUuid){d=a.getUuid()}}}if(!d){return}var c=this.jstree.create_node(d,e.getLabel());this.jstree.set_id(c,e.getUuid());this.jstree.get_node(e.getUuid()).element=e;e.addListener("modelExplorer",this);var f=Object.getOwnPropertyNames(e).filter(function(g){return e.propertyIsEnumerable(g)});for(var b=0;b<f.length;b++){if(e[f[b]] instanceof Array){this.createArray(e,f[b])}else{if(typeof e[f[b]]==="object"){this.createReference(e,f[b])}else{this.createLeaf(e,f[b])}}}};fleximeta.views.ModelExplorer.prototype.createArray=function(e,d){var c=e.getUuid()+"_"+d,f=e[d];var b=this.jstree.create_node(e.getUuid(),d);this.jstree.set_id(b,e.getUuid()+"_"+d);for(var a=0;a<f.length;a++){this.createNode(f[a],e.getUuid()+"_"+d)}};fleximeta.views.ModelExplorer.prototype.createLeaf=function(c,b){if(b==="uuid"||b==="label"){return}var a=this.jstree.create_node(c.getUuid(),b+" = "+c[b]);this.jstree.set_id(a,c.getUuid()+"_"+b);this.jstree.set_icon(c.getUuid()+"_"+b,"./img/tag.png")};fleximeta.views.ModelExplorer.prototype.createReference=function(c,b){var a=this.jstree.create_node(c.getUuid(),b+" -> "+c[b].get("label"));this.jstree.set_id(a,c.getUuid()+"_"+b)};fleximeta.views.ModelExplorer.instance=null;fleximeta.views.ModelExplorer.getInstance=function(){return fleximeta.views.ModelExplorer.instance};fleximeta.views.ModelExplorer.prototype.update=function(c,b,d,a){if(b==="PUSH"){this.createNode(a[0],c.getUuid()+"_"+d)}else{if(b==="SET"){this.updateLabel(c);this.updateLeaf(c,d,a)}}};fleximeta.views.ModelExplorer.prototype.updateLabel=function(a){this.jstree.set_text(a.getUuid(),a.getLabel())};fleximeta.views.ModelExplorer.prototype.updateLeaf=function(b,a,c){this.jstree.set_text(b.getUuid()+"_"+a,a+" = "+b.getLabel())};fleximeta.views.ModelExplorer.prototype.reinitialize=function(a){this.jstree.destroy();this.jstree=$.jstree.create($(this.li),{core:{check_callback:true,}});this.createNode(a)}})();(function(){fleximeta.views.Validation=function(d){d=d||{};var e=d.element,a=e.nextElementSibling,c=this,b=document.createElement("div");b.className="links";e.appendChild(b);b.innerHTML+="<a href='' style='margin-right:5px;'><span class='glyphicon glyphicon-question-sign'></span></a>";b.innerHTML+="<a href='' style='margin-right:5px;'><span class='glyphicon glyphicon-repeat'></span></a>";b.innerHTML+="<a href='' style='margin-right:5px;'><span class='glyphicon glyphicon-cog'></span></a>";this.li=a;this.model=d.model;this.phase=d.phase;this.errors=[];this.timer=5000;this.setTimer(5000)};fleximeta.views.Validation.prototype.setTimer=function(a){this.timer=a;this.cancelTimer();this.startTimer()};fleximeta.views.Validation.prototype.cancelTimer=function(){if(this.timerId){window.clearInterval(this.timer)}};fleximeta.views.Validation.prototype.startTimer=function(){this.timerId=setInterval(this.refresh.bind(this),this.timer)};fleximeta.views.Validation.prototype.refresh=function(){var a=this.model.validate();if(!a.length){this.appearNoErrorMessage()}else{this.removeNoErrorMessage()}this.addAlerts(a);this.removeAlerts(a)};fleximeta.views.Validation.prototype.addAlerts=function(g){for(var d=0;d<g.length;d++){var c=g[d],f=c.element.uuid+"-"+c.id,b=c.label,a=this.errors.indexOf(f);if(a!==-1){return}this.errors.push(f);var e=(this.phase<2)?"warning":"danger";this.appearMessage(f,e,b)}};fleximeta.views.Validation.prototype.reinitialize=function(){this.cancelTimer();for(var a=0;a<this.errors.length;a++){this.removeMessage(this.errors[a])}this.errors=[];this.startTimer()};fleximeta.views.Validation.prototype.removeAlerts=function(e){var c=e.map(function(f){return f.element.uuid+"-"+f.id});console.log(c);for(var b=0;b<this.errors.length;b++){var d=this.errors[b],a=c.indexOf(d);if(a!==-1){return}this.errors.splice(a,1);this.removeMessage(d)}};fleximeta.views.Validation.prototype.appearNoErrorMessage=function(){var a=document.getElementById("noErrorFound");if(a){return}this.appearMessage("noErrorFound","info","No error found")};fleximeta.views.Validation.prototype.removeNoErrorMessage=function(){var a=document.getElementById("noErrorFound");if(!a){return}this.removeMessage("noErrorFound")};fleximeta.views.Validation.prototype.removeMessage=function(b){var a=document.getElementById(b);$(a).fadeOut("fast",function(){$(this).remove()})};fleximeta.views.Validation.prototype.appearMessage=function(d,a,b){var c=document.createElement("div");c.className="alert alert-"+a;c.id=d;c.innerHTML=b;this.li.appendChild(c);$(c).hide().fadeIn("fast")}})();(function(){var a=(function(){var e=Math.pow(2,32)-1,c=Object.prototype.hasOwnProperty;function d(f){return f>>>0}function b(f){var g=-1,h;for(var i in f){h=(String(d(i))===i&&d(i)!==e&&c.call(f,i));if(h&&i>g){g=i}}return g}return function(f){var g=0;f=f||{};f.length={get:function(){var h=+b(this);return Math.max(g,h+1)},set:function(l){var j=d(l);if(j!==+l){throw new RangeError()}for(var k=j,h=this.length;k<h;k++){delete this[k]}g=j}};f.toString={value:Array.prototype.join};f.toJSON={value:fleximeta.model.Collection.prototype.toJSON};f.push={value:fleximeta.model.Collection.prototype.push};f.splice={value:fleximeta.model.Collection.prototype.splice};f.addListener={value:fleximeta.model.Collection.prototype.addListener};f.notify={value:fleximeta.model.Collection.prototype.notify};return Object.create(Array.prototype,f)}})();fleximeta.model.Collection=(function(){var b={last:{value:function(){return this[this.length-1]}}};return function(){var c=a(b);Object.defineProperty(c,"listeners",{enumerable:false,writable:true});c.listeners=[];if(arguments.length===1){c.length=arguments[0]}else{c.push.apply(c,arguments)}return c}})();fleximeta.model.Collection.prototype.toJSON=function(){var b=[];for(var c=0;c<this.length;c++){b.push(this[c])}return b};fleximeta.model.Collection.prototype.push=function(){Array.prototype.push.apply(this,arguments);this.notify("PUSH",arguments)};fleximeta.model.Collection.prototype.splice=function(){this.notify("REMOVE",arguments);Array.prototype.splice.apply(this,arguments);if(arguments[2]){arguments.length=1;arguments[0]=arguments[2]}};fleximeta.model.Collection.prototype.addListener=function(c,b){if(this.listeners.indexOf(c)===-1){this.listeners.push({listener:c,propertyName:b})}};fleximeta.model.Collection.prototype.removeListener=function(c){var b=this.listeners.indexOf(c);if(b!==-1){this.listeners.splice(b,0)}};fleximeta.model.Collection.prototype.notify=function(b,c){for(var d in this.listeners){this.listeners[d].listener.update(this,b,this.listeners[d].propertyName,c)}}})();(function(){var d=[];for(var c=0;c<256;c++){d[c]=(c<16?"0":"")+(c).toString(16)}var b=function b(i,g,h,f,e){this.uuid=i;this.object=g;this.key=h;this.index=f;this.klass=e||fleximeta.model.Base};var a={};a.placeholders={};fleximeta.model.Base=function(e){Object.defineProperty(this,"uuid",{enumerable:true,writable:true});Object.defineProperty(this,"label",{enumerable:true,writable:true});Object.defineProperty(this,"listeners",{enumerable:false,writable:true});this.listeners={};e||(e={});this.set(e);if(!this.uuid){this.uuid=this.generateUuid()}};fleximeta.model.Base.emptyCache=function(){a={};a.placeholders={};this.createCache()};fleximeta.model.Base.createCache=function(){a.save=function(g){var e=fleximeta.model.Base;if(!(g instanceof fleximeta.model.Base)){if(this.placeholders[g.uuid]){e=this.placeholders[g.uuid][0].klass}g=new e(g)}if(typeof(this[g.uuid])==="undefined"){this[g.uuid]=g;if(this.placeholders[g.uuid]){for(var h=0;h<this.placeholders[g.uuid].length;h++){var j=this.placeholders[g.uuid][h],f=j.object instanceof Array;if(!f){j.object.set(j.key,g)}else{j.object.splice(j.index,1,g)}}}}return this[g.uuid]};a.restore=function(i,g,h,f,e){if(i==null){return null}var j=this[i];if(typeof(j)==="undefined"){j=new b(i,g,h,f,e);if(typeof(this.placeholders[i])==="undefined"){this.placeholders[i]=[]}this.placeholders[i].push(j)}return j}};fleximeta.model.Base.createCache();fleximeta.model.Base.prototype.generateUuid=function(){var h=Math.random()*4294967295|0,g=Math.random()*4294967295|0,f=Math.random()*4294967295|0,e=Math.random()*4294967295|0;return d[h&255]+d[h>>8&255]+d[h>>16&255]+d[h>>24&255]+"-"+d[g&255]+d[g>>8&255]+"-"+d[g>>16&15|64]+d[g>>24&255]+"-"+d[f&63|128]+d[f>>8&255]+"-"+d[f>>16&255]+d[f>>24&255]+d[e&255]+d[e>>8&255]+d[e>>16&255]+d[e>>24&255]};fleximeta.model.Base.prototype.getUuid=function(){return this.uuid};fleximeta.model.Base.prototype.get=function(e){return this[e]};fleximeta.model.Base.prototype.set=function(f,g){if(typeof f==="object"){for(var e in f){this.set(e,f[e])}return}if(g instanceof Array){this.setCollection(f,g)}else{if(typeof g==="object"){this[f]=a.save(g)}else{if(this.isId(f,g)){this[f]=a.restore(g,this,f)}else{this[f]=g}}}if(typeof g==="object"&&g.notify){g.addListener(this.uuid,this)}this.notify("SET",f,g)};fleximeta.model.Base.prototype.isId=function(e,f){return e!="uuid"&&f&&f.length===36};fleximeta.model.Base.prototype.unset=function(e){if(this[e]){delete this[e]}};fleximeta.model.Base.prototype.setCollection=function(h,l,e){var k=new fleximeta.model.Collection(),l=l.sort(function(m,i){if(typeof i==="string"&&typeof m==="string"){return 0}return(typeof i==="string")?1:-1}),e=e||fleximeta.model.Base;if(l&&(l instanceof Array)){for(var g=0;g<l.length;g++){var j=l[g],f;if(typeof j==="object"){f=a.save(new e(j))}else{if(this.isId(h,j)){f=a.restore(j,k,null,g,e)}else{f=l[g]}}k.push(f)}}this[h]=k;this[h].addListener(this,h)};fleximeta.model.Base.prototype.getLabel=function(){return this.label||this.name||this.uuid};fleximeta.model.Base.prototype.validate=function(f,e){f=f||[];if(!e){return f}return f};fleximeta.model.Base.prototype.find=function(e){if(typeof e!=="string"){return e}if(this.getUuid()===e){return this}var k=Object.keys(this);for(var h=0;h<k.length;h++){var l=this[k[h]];if(l instanceof Array){for(var g=0;g<l.length;g++){if(!l[g].find){break}var f=l[g].find(e);if(f){return f}}}else{if(l&&l.find){var f=l.find(e);if(f){return f}}}}return null};fleximeta.model.Base.prototype.addListener=function(e,f){this.listeners[e]=f};fleximeta.model.Base.prototype.removeListener=function(e){delete this.listeners[e]};fleximeta.model.Base.prototype.notify=function(f,g,e){};fleximeta.model.Base.prototype.update=function(g,f,h,e){this.notify(f,h,e)}})();(function(c){var b=[];for(var a=0;a<256;a++){b[a]=(a<16?"0":"")+(a).toString(16)}fabric.util.object.extend(fabric.Object.prototype,{iduu:undefined,model:undefined,initialize:function(d){d||(d={});this.setOptions(d);this.set("uuid",d.uuid||this.generateUuid());this.setModel(d.model)},toObject:function(f){var e=fabric.Object.NUM_FRACTION_DIGITS,d={uuid:this.uuid,model:(this.model)?this.model.getUuid():null,type:this.type,left:fabric.util.toFixed(this.left,e),top:fabric.util.toFixed(this.top,e),width:fabric.util.toFixed(this.width,e),height:fabric.util.toFixed(this.height,e),};if(!this.includeDefaultValues){d=this._removeDefaultValues(d)}fabric.util.populateWithProperties(this,d,f);return d},getUuid:function(){return this.uuid},generateUuid:function(){var g=Math.random()*4294967295|0,f=Math.random()*4294967295|0,e=Math.random()*4294967295|0,d=Math.random()*4294967295|0;return b[g&255]+b[g>>8&255]+b[g>>16&255]+b[g>>24&255]+"-"+b[f&255]+b[f>>8&255]+"-"+b[f>>16&15|64]+b[f>>24&255]+"-"+b[e&63|128]+b[e>>8&255]+"-"+b[e>>16&255]+b[e>>24&255]+b[d&255]+b[d>>8&255]+b[d>>16&255]+b[d>>24&255]},getModel:function(){return this.model},setModel:function(d){if(!d){return}this.model=d;if(typeof d==="string"){return}if(typeof d==="object"&&d.addListener){this.model.addListener(this);if(this.updateIcon){this.updateIcon()}}},})})();(function(){fabric.Grid=fabric.util.createClass(fabric.Object,{type:"grid",initialize:function(a){a||(a={});this.callSuper("initialize",a);this.set("grid",a.grid||10);this.set("stroke",a.stroke||"silver");this.set("evented",false);this.set("selectable",false);this.set("width",a.width);this.set("height",a.height);this.set("left",0);this.set("top",-1)},toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{grid:this.get("grid")})},_render:function(b,f){var d=this.grid;var e=this.width;var a=this.height;if(d){b.beginPath();b.globalAlpha=0.4;for(var c=0;c<a;c+=5*d){b.moveTo(-e/2,c-a/2);b.lineTo(e/2,c-a/2)}for(var c=0;c<e;c+=5*d){b.moveTo(c-e/2,-a/2);b.lineTo(c-e/2,a/2)}b.stroke();b.closePath();b.beginPath();b.globalAlpha=0.2;for(var c=0;c<a;c+=d){b.moveTo(-e/2,c-a/2);b.lineTo(e/2,c-a/2)}for(var c=0;c<e;c+=d){b.moveTo(c-e/2,-a/2);b.lineTo(c-e/2,a/2)}b.stroke();b.closePath()}},});fabric.Grid.fromObject=function(a){return new fabric.Grid(a)}})();(function(){var a=undefined;fleximeta.editor.Canvas=fabric.util.createClass(fabric.Canvas,{initialize:function(c,b){b||(b={});this.callSuper("initialize",c,b);if(b.model){this.model=b.model}else{this.model=new fleximeta.model.Base({label:"The Simpson Family",lastname:"Simpson",address:"742 Evergreen Terrace"});this.model.setCollection("members")}this.contextMenu={add:{name:"Add Member",icon:"add",callback:"addMember"},rename:{name:"Rename Family",icon:"edit",callback:"rename"}}},getContextMenu:function(){return this.contextMenu},find:function(c){var b=this.getObjects().filter(function(d){return d.uuid===c});if(b.length){return b[0]}return undefined},rename:function(){var c=this.model,b=fleximeta.Narrator.getInstance();b.createPromptModal({narrator:"bart",name:"Rename",label:"New name of the family",hideOnFinish:"yes",defaultValue:this.model.get("lastname"),onSubmit:function(f,d){c.set("lastname",d[0].value);c.set("label","The "+d[0].value+" family")}})},addMember:function(c){var b=new fabric.Individual({left:c.offsetX,top:c.offsetY,label:"new member",width:200,height:160,attributes:[{name:"firstname",value:""}]});this.add(b);this.renderAll();this.model.get("members").push(b.model);b.rename()},resolve:function(){console.log("test")},createGrid:function(){var b=this;var c=new fabric.Grid({width:editor.offsetWidth,height:editor.offsetHeight});this.add(c);c.cloneAsImage(function(d){d.set({left:c.left,top:c.top,scaleX:1,evented:false,selectable:false,lockMovement:true,scaleY:1});b.insertAt(d,0);b.remove(c)})},_setObjectScale:function(m,d,k,h,j,c,l){var g=d.target,n=d.target.__corner,i=(m.x)/d.offsetX,f=(m.y)/d.offsetY,o=g.get("minimumWidth")||0,p=g.get("minimumHeight")||0;if(n==="tl"||n==="tr"||n==="mt"){f=(m.y)/g.originalState.height}if(n==="ml"||n==="tl"||n==="bl"){i=(m.x)/g.originalState.width}var e=g.originalState.width*i,b=g.originalState.height*f;if(j==="x"||j==="equally"){if(e>=o){g.set("width",g.originalState.width*i)}}if(j==="y"||j==="equally"){if(b>=p){g.set("height",g.originalState.height*f)}}},initiateConnection:function(b){a=b;this.on("object:selected",this.terminateConnection)},terminateConnection:function(d){var c=d.target;if(c!==a){var b=new fabric.Relation({source:a,target:c,relation:"newRelation"});this.add(b);this.renderAll();b.editRelation();a=undefined}},save:function(){var b=this.toJSON(),c=b.objects[0];if(c.type==="grid"||c.type==="image"){b.objects.splice(0,1)}b.model=(this.model)?this.model.getUuid():undefined;return b},load:function(f){var e=this,d=this.model,f=f||{objects:[],background:"white"},c={};f.renderOnAddRemove=false;f.targetFindToleance=6;fabric.util.enlivenObjects(f.objects,function(h){e.createGrid();for(var g=0;g<h.length;g++){h[g].resolve(c);e.add(h[g])}e.renderAll()},"fabric",function b(g,h){c[g.uuid]=h;var i=h.getModel();if(!i){return}i=d.find(i);h.setModel(i)})}})})();(function(a){fabric.Individual=fabric.util.createClass(fabric.Object,{type:"individual",initialize:function(c){c||(c={});this.callSuper("initialize",c);this.set({minimumWidth:150,minimumHeight:100,fill:"white",stroke:"black",outgoings:c.outgoings||[],incomings:c.incomings||[]});var b={};if(c.attributes){for(var d=0;d<c.attributes.length;d++){b[c.attributes[d].name]=c.attributes[d].value}b.label=c.label}if(!this.model){this.model=new fleximeta.model.Base(b)}},getContextMenu:function(){this.contextMenu={rename:{name:"Rename Member",icon:"edit",callback:"rename"},sep1:"---------",attributes:{name:"Attributes",items:{addAttribute:{name:"Add New Attribute",icon:"add",callback:this.addAttribute.bind(this)},sep2:"---------",}},references:{name:"References",items:{addReference:{name:"Add New Ref",icon:"add",callback:this.connect.bind(this)},sep3:"---------",}},sep4:"---------","delete":{name:"Delete",icon:"delete",callback:"deleteIndividual"},};var b=this.contextMenu.attributes.items,e=this.contextMenu.references.items,d=this.model,h=this.getEditableAttributeKeys(),c=Object.getOwnPropertyNames(d).filter(function(k){var l=d[k],m=d.propertyIsEnumerable(k),j=d[k] instanceof Array,i=typeof d[k]==="object",n=j&&l.length&&typeof l[0]==="object";return m&&(n||i)});for(var g=0;g<h.length;g++){var f=h[g];b[f]={name:f,items:{}};b[f].items["edit_name_"+f]={name:"Edit Name",icon:"edit",callback:this.editAttributeNameHandler.bind(this)};b[f].items["edit_value_"+f]={name:"Edit Value",icon:"edit",callback:this.editAttributeValueHandler.bind(this)};b[f].items.sep="---------";b[f].items[f]={name:"Delete Attribute",icon:"delete",callback:this.deleteAttribute.bind(this)}}if(!h.length){b.nothing={name:"No attribute",disabled:true}}for(var g=0;g<c.length;g++){var f=c[g];e[f]={name:f,items:{}};e[f].items["edit_name_"+f]={name:"Edit Name",icon:"edit",callback:this.editReferenceNameHandler.bind(this)};e[f].items.sep="---------";e[f].items[f]={name:"Delete Reference",icon:"delete",callback:this.deleteReference.bind(this)}}if(!c.length){e.nothing={name:"No reference",disabled:true}}return this.contextMenu},toObject:function(d){var b=this.incomings.map(function(e){return e.getUuid()});var c=this.outgoings.map(function(e){return e.getUuid()});return fabric.util.object.extend(this.callSuper("toObject",d),{incomings:b,outgoings:c,})},resolve:function(b){this.incomings=this.incomings.map(function(c){if(typeof c==="string"){return b[c]}else{return c}});this.outgoings=this.outgoings.map(function(c){if(typeof c==="string"){return b[c]}else{return c}})},addAttribute:function(){var d,e,c=this,b=fleximeta.Narrator.getInstance();this.editAttributeName(null,function(g,f){d=f[0].value},function(){c.editAttributeValue(null,function(g,f){e=f[0].value;c.model.set(d,e)},function(){c.canvas.renderAll()})})},editAttributeNameHandler:function(f){var e=this.model,d=f.split("_")[2],g=e[d],b=fleximeta.Narrator.getInstance(),c=this.canvas;this.editAttributeName(d,function(i,h){e.unset(d);e.set(h[0].value,g)},function(){c.renderAll()})},editReferenceNameHandler:function(e){var d=this.model,g=e.split("_")[2],f=d[g],b=this,c=this.canvas;this.editAttributeName(g,function(i,h){d.set(h[0].value,f);b.outgoings.filter(function(j){return j.relation===g}).forEach(function(j){j.relation=h[0].value});d.unset(g)},function(){c.renderAll()},true)},editAttributeValueHandler:function(f){var e=this.model,d=f.split("_")[2],g=e[d],b=fleximeta.Narrator.getInstance(),c=this.canvas;this.editAttributeValue(d,function(i,h){e.set(d,h[0].value);c.renderAll();b.hide();return true},function(){c.renderAll()})},editAttributeName:function(i,g,e,f){var d=(f)?"reference":"attribute",b=(i)?"Rename":"Set name",j="Name of the "+d+":",c=fleximeta.Narrator.getInstance(),h=(i)?"yes":"no",k=i||"";c.createPromptModal({name:b,label:j,defaultValue:k,hideOnFinish:h,placeholder:d,onSubmit:g,onFinished:e})},editAttributeValue:function(e,h,f){var d="Set value",c="Value of the attribute:",b=fleximeta.Narrator.getInstance(),g=(e)?this.model[e]:"";b.createPromptModal({name:d,label:c,defaultValue:g,hideOnFinish:"yes",placeholder:"attribute",onSubmit:h,onFinished:f})},deleteAttribute:function(e){var d=this.canvas,b=fleximeta.Narrator.getInstance(),c=this.model;b.createValidationModal({name:"Delete attribute",label:"Are you sure you want to delete the '"+e+"' attribute ?",onResult:function(f){if(f){c.unset(e);d.renderAll()}}})},deleteIndividual:function(){var c=this,b=fleximeta.Narrator.getInstance();b.createValidationModal({name:"Remove Individual",label:"Are you sure you want to delete this family member ?",onResult:function(d){if(d){c.deleteNode()}},onFinished:function(){c.canvas.renderAll()}})},deleteReference:function(e){var d=this.canvas,f=this.outgoings,b=fleximeta.Narrator.getInstance(),c=this.model;b.createValidationModal({name:"Delete reference",label:"Are you sure you want to delete the '"+e+"' reference ?",onResult:function(g){if(g){c.unset(e);var h=f.filter(function(i){return i.relation===e}).forEach(function(i){i.deleteEdge()});d.renderAll()}}})},connect:function(){this.canvas.initiateConnection(this)},rename:function(){var d=this.model,c=fleximeta.Narrator.getInstance(),b=this;c.createPromptModal({name:"Rename",label:"New name of the member:",defaultValue:d.get("firstName"),placeholder:"firstname",onSubmit:function(g,f){d.set("firstname",f[0].value);d.set("label",f[0].value)},onFinished:function(){c.hide();b.canvas.renderAll()},})},_render:function(b,c){fabric.Rect.prototype._render.call(this,b,c);b.save();this._renderName(b);this._renderSeparator(b);this._renderAttributes(b);b.restore()},_renderName:function(b){b.font="20px Arial";b.fillStyle="black";b.textAlign="center";var c=this.fittingString(b,this.model.getLabel(),this.width-8);b.fillText(c,0,-this.height/2+20)},_renderSeparator:function(b){b.beginPath();b.moveTo(-this.width/2,-this.height/2+30);b.lineTo(this.width/2,-this.height/2+30);b.stroke()},getEditableAttributeKeys:function(){var b=this.model;return Object.getOwnPropertyNames(b).filter(function(e){var h=b[e],i=b.propertyIsEnumerable(e),d=b[e] instanceof Array,g=(e==="uuid"),f=(e==="label"),c=typeof b[e]==="object",j=d&&h.length&&typeof h[0]==="object";return i&&!j&&!c&&!g&&!f})},_renderAttributes:function(c){c.font="16px Arial";c.fillStyle="black";c.textAlign="left";var e=this.model,h=this.getEditableAttributeKeys();for(var f=0;f<h.length;f++){var b=-this.height/2+20+20*(f+1)+10,d=f<h.length&&(20+20*(f+2)+10)>this.height;if(d){c.fillText("…",-this.width/2+24,-this.height/2+20+20*(f+1)+10);break}var g=this.model[h[f]],j=this.fittingString(c,h[f]+" = "+g,this.width-28);c.fillText(j,-this.width/2+24,-this.height/2+20+20*(f+1)+10)}},fittingString:function(c,h,g){var f=c.measureText(h).width;var d="…";var e=c.measureText(d).width;if(f<=g||f<=e){return h}else{var b=h.length;while(f>=g-e&&b-->0){h=h.substring(0,b);f=c.measureText(h).width}return h+d}},getAnchor:function(f){var d=Math.atan(this.height/this.width),c=Math.PI-d,h=Math.PI+d,e=2*Math.PI-d;if(f<=d||f>=e){var b=this.left+this.width,g=this.top+this.height/2*(1+Math.sin(f))}else{if(f>d&&f<=c){var b=this.left+this.width/2*(1+Math.cos(f)),g=this.top+this.height}else{if(f>c&&f<=h){var b=this.left,g=this.top+this.height/2+this.height/2*Math.sin(f)}else{if(f>h&&f<e){var b=this.left+this.width/2*(1+Math.cos(f)),g=this.top}}}}return{x:b,y:g}},getAnchorPosition:function(e){var c=Math.atan(this.height/this.width),b=Math.PI-c,f=c+Math.PI,d=b+Math.PI;if(e<=c||e>=d){return"right"}else{if(e>c&&e<=b){return"bottom"}else{if(e>b&&e<=f){return"left"}else{if(e>f&&e<d){return"top"}}}}},deleteNode:function(){for(var d=0;d<this.incomings.length;d++){this.incomings[d].deleteEdge()}for(var d=0;d<this.outgoings.length;d++){this.outgoings[d].deleteEdge()}if(this.model){var b=this.canvas.model.get("members"),c=b.indexOf(d);if(c!==-1){b.splice(c,1)}}this.canvas.remove(this)},addIncomingEdge:function(c){var b=this.incomings.indexOf(c);if(b===-1){this.incomings.push(c)}},addOutgoingEdge:function(c){var b=this.outgoings.indexOf(c);if(b===-1){this.outgoings.push(c)}},removeIncomingEdge:function(c){var b=this.icomings.indexOf(c);if(b!==-1){this.icomings.splice(b,1)}},removeOutgoingEdge:function(c){var b=this.outgoings.indexOf(c);if(b!==-1){this.outgoing.splice(b,1)}}});fabric.Individual.fromObject=function(b){return new fabric.Individual(b)}})();(function(){fabric.Relation=fabric.util.createClass(fabric.Object,{type:"relation",initialize:function(a){a||(a={});this.callSuper("initialize",a);this.set({source:a.source||null,target:a.target||null,relation:a.relation||null,selectable:false,lockMovementX:true,lockMovementY:true,perPixelTargetFind:true,angle:0});this.contextMenu={edit:{name:"Edit Relation",icon:"edit",callback:"editRelation"},"delete":{name:"Delete",icon:"delete",callback:"deleteRelation"},};if(typeof this.source==="object"&&typeof this.target==="object"){this.source.addOutgoingEdge(this);this.target.addIncomingEdge(this);this.calcWidthHeight()}},getContextMenu:function(){return this.contextMenu},editRelation:function(){var a=this.source.model,e=this.target.model,c=fleximeta.Narrator.getInstance(),d=a[this.relation],b=this;var f={ref:a[this.relation],isExist:true,isEnumerable:true,isArray:a[this.relation] instanceof Array,isObject:typeof a[this.relation]==="object"};f.isArrayOfObjects=f.isArray;c.createPromptModal({name:"Edit relation",label:"New name of the relation:",defaultValue:this.relation,onSubmit:function(i,h){var g={};h=h[0].value;g.value=a[h];g.isExist=a[h];g.isEnumerable=g.isExist&&a.propertyIsEnumerable(h);g.isArray=g.isEnumerable&&a[h] instanceof Array;g.isObject=g.isEnumerable&&typeof a[h]==="object";g.isArrayOfObjects=g.isArray&&g.value.length&&typeof g.value[0]==="object";if(g.isExist){if(!g.isEnumerable){return"this keyword is reserved"}if(!g.isObject&&!g.isArrayOfObjects){return"an attribute with this name already exists"}if(g.isArray&&!g.isArrayOfObjects){return"an array of attributes with this name already exists"}if(g.isArrayOfObjects){return"an array of objects this name already exists"}else{if(g.isObject){return"an object with this name already exists"}}}a.set(h,e);b.relation=h;return true},onFinished:function(){b.canvas.renderAll()},})},calcWidthHeight:function(){var f=this.source.getCenterPoint(),d=this.target.getCenterPoint(),e=this.calcAngle(f,d),c=(e>Math.PI)?e-Math.PI:e+Math.PI,b=this.source.getAnchor(e,false),a=this.target.getAnchor(c,true);this.set({width:a.x-b.x,height:a.y-b.y,left:b.x,top:b.y,beginPoint:{x:-this.width/2,y:-this.height/2},endPoint:{x:this.width/2,y:this.height/2},cangle:this.calcAngle(b,a)});this.setCoords()},calcAngle:function(e,c){var b=c.x-e.x,a=c.y-e.y,d=Math.atan2(a,b);if(d<0){d=2*Math.PI+d}return d},_renderSimpleArrow:function(b,f,d,e,g,a){var c=(a==="begin")?1:-1;b.beginPath();b.moveTo(f.x,f.y);b.lineTo(f.x+c*d*Math.cos(g-e),f.y+c*d*Math.sin(g-e));b.moveTo(f.x,f.y);b.lineTo(f.x+c*d*Math.cos(g+e),f.y+c*d*Math.sin(g+e));b.lineWidth=1;b.stroke();return f},toObject:function(a){return fabric.util.object.extend(this.callSuper("toObject",a),{relation:this.relation,source:(this.source)?this.source.getUuid():null,target:(this.target)?this.target.getUuid():null,})},resolve:function(a){this.source=a[this.source];this.target=a[this.target]},_renderLabel:function(i){var c=this.cangle,d=(c>Math.PI)?c-Math.PI:c+Math.PI,b=this.target.getAnchorPosition(d,true),e="center",g=0,f=0;i.font="14px Arial";i.fillStyle="white";i.textAlign=e;var a=i.measureText(this.relation).width,h=20;i.fillRect(-a/2,-h/2,a,h);i.stroke();i.fillStyle="black";i.fillText(this.relation,g,f)},_render:function(a,b){this.calcWidthHeight();a.strokeStyle="black";a.beginPath();a.moveTo(-this.width/2,-this.height/2);a.lineTo(this.width/2,this.height/2);a.stroke();this._renderSimpleArrow(a,this.endPoint,10,Math.PI/6,this.cangle);this._renderLabel(a)},deleteRelation:function(){var b=this,a=fleximeta.Narrator.getInstance();a.createValidationModal({name:"Remove Relation",label:"Are you sure you want to delete this relation ?",onResult:function(c){if(c){b.deleteEdge()}},onFinished:function(){b.canvas.renderAll()}})},deleteEdge:function(){this.source.model.unset(this.relation);this.canvas.remove(this)}});fabric.Relation.fromObject=function(a){return new fabric.Relation(a)}})();(function(){var a=undefined,b,d,e,c=0;fleximeta.Narrator=function(){};fleximeta.Narrator.prototype.showScenarios=function(){};fleximeta.Narrator.prototype.showPrivacy=function(f,g){this.fadeIn();a=["To respect the privacy of the review, an <mark>anonymous session</mark> is created and an <mark>anonymous ID</mark> is generated during your first visit. This session is only used to save and restore the model you created, and we do not store any information from you or your browser.","We do not <mark>collect</mark> nor <mark>analyse</mark> your IP. Only the <mark>user-agent</mark> of your browser is collected to know if you are using a compatible browser to visit this website. This information is not <mark>stored</mark>.","<mark>HTML5 history</mark> is used to store some information on your browser. This information are:<ul><li>The preferences you set for each view using the <span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span> icon;</li><li>If it is your first visit (to not make the introduction message appear again);</li><li>Nothing else.</li></ul>","You can activate (if you have not already) the private browsing from your browser.","If you do not want to use the website, you can also consult this video to understand how it works.",];e=g;d=f;c=0;this.wrapper.click()};fleximeta.Narrator.prototype.showConsolidationPhase=function(f,g){this.fadeIn();a=["No, no, Bart, You cannot do whatever your want !","You have to ensure that your model satisfies the rules of my metamodel !","In consolidation phase, you can correct your model with respect to the metamodel !",];e=g;d=f;c=0;this.wrapper.click()};fleximeta.Narrator.prototype.showFinalizationPhase=function(f,g){this.fadeIn();a=["Children you have to be more ordoned :)","To strictly validate your model, you should ensure that all the rules are not violated","In finalization phase, you are no longer flexible",];e=g;d=f;c=0;this.wrapper.click()};fleximeta.Narrator.prototype.showPresentationScenario=function(f,g){this.fadeIn();a=["Hi!<br />I am Bart Simpson. I am here to guide you through this tutorial","In this tutorial, we will learn how to use FlexiMeta","The screen is composed of several area","The main area is a graphical editor to edit the model","On the left and right, you have several menus","The <mark>model explorer</mark> is at the top of the left menu. It allows you to explore the model. Easy, isn't it ?","The <mark>problem explorer</mark> is at the bottom of the left menu. But with me, there is never any problem :)","On the top right, you have a spider diagram. It helps you remember in which phase you are and reminds you the benefits of each.","As a reminder, there are three phases: <mark>Exploratory Phase</mark>, <mark>Consolidation Phase</mark>, and <mark>Finalization Phase</mark>. For the moment, you are in the <mark>Exploratory Phase</mark>. That means you can create models without relying on metamodels. Everything is permitted ! That's cool, right ?","On the bottom right, you have some resources to help you","Below the graphical editor, you can see how the model is serialized into JSON.","Another view below the graphical editor allows you to export your model into XML. Let's get rid of that for the moment, will you ?","Now, let's begin to model my family :)","To help you, I'll give you an example. I will add my dad and mom, and myself into the diagram. Feel free to do any change as you want.","If you don't remember all the things I told you, don't worry :) I can explain it again if you click on the Help button on top of the editor.","If you move the cursor over a view, <span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span> icon will appear.","Click on the <span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span> icon and I will give you more details about this specific view.","Now, let's begin !!!",];e=g;d=f;c=0;this.wrapper.click()};fleximeta.Narrator.prototype.createValidationModal=function(g){this.fadeIn();var f=this,h=!b.classList.contains("appear"),j=g.hideOnFinish||"yes";var k=g.defaultValue||"",l=g.placeholder||"";var i=$('<form id="newValueForm"><div class="form-group"><label>'+g.label+'</label><div class="input-group"><span class="input-group-btn"><button type="submit" class="btn btn-search">Yes</button> <button type="reset" class="btn btn-search">No</button></span></div></div></form>');$(b).data("bs.popover").options.content=i[0];i.bind("submit",function(n){n.preventDefault();var m=g.onResult(true);if(m===false){return}if(j==="yes"){f.hide()}if(g.onFinished){g.onFinished(true)}});i.bind("reset",function(n){n.preventDefault();var m=g.onResult(false);if(m===false){return}if(j==="yes"){f.hide()}if(g.onFinished){g.onFinished(false)}});if(h){b.classList.add("appear");setTimeout(function(){$(b).popover("show")},500)}else{$(b).popover("show")}};fleximeta.Narrator.prototype.createPromptModal=function(g){this.fadeIn();var f=this,h=!b.classList.contains("appear"),j=g.hideOnFinish||"yes";var k=g.defaultValue||"",l=g.placeholder||"";var i=$('<form id="newValueForm"><div class="form-group"><label for="newValue">'+g.label+'</label><div class="input-group"><input type="text" name="newValue" class="form-control" id="newValue" placeholder="'+l+'" value="'+k+'"><span class="input-group-btn"><button type="submit" class="btn btn-search">OK</button></span></div></div></form>');$(b).data("bs.popover").options.content=i[0];i.bind("submit",function(n){n.preventDefault();var m=g.onSubmit(n,$(this).serializeArray());if(m===false){return}if(j==="yes"){f.hide()}if(g.onFinished){g.onFinished()}});i.bind("reset",function(m){m.preventDefault();if(g.onReset){g.onReset(m)}if(j==="yes"){f.hide()}if(g.onFinished){g.onFinished()}});if(h){b.classList.add("appear");setTimeout(function(){$(b).popover("show")},500)}else{$(b).popover("show")}};fleximeta.Narrator.prototype.hide=function(h){var g=this,f=b;$(f).popover("hide");setTimeout(function(){f.classList.remove("appear");g.fadeOut()},200)};fleximeta.Narrator.prototype.play=function(){if(!a){return}if(c>a.length-1){var h=a[c-1],f=this;$(b).data("bs.popover").options.content="";$(b).popover("show");$(b).popover("hide");setTimeout(function(){b.classList.remove("appear");if(e){e()}f.fadeOut()},200);a=undefined;c=0;return}var h=a[c],g=!b.classList.contains("appear");$(b).data("bs.popover").options.content=h;c++;if(g){b.classList.add("appear");setTimeout(function(){$(b).popover("show")},500)}else{$(b).popover("show")}};fleximeta.Narrator.prototype.fadeIn=function(){$(this.wrapper).fadeIn()};fleximeta.Narrator.prototype.fadeOut=function(){$(this.wrapper).fadeOut()};fleximeta.Narrator.prototype.init=function(){var f=[{title:"Presentation",scenario:this.showPresentationScenario}];this.wrapper=document.createElement("div");this.wrapper.id="wrap";$(this.wrapper).on("click",this.play.bind(this));document.body.appendChild(this.wrapper);this.addNarrator("Bart","right");this.addNarrator("Lisa","left");this.addNarrator("Marge","left");$("body").delegate(".popover-content","keyup",function(g){if(g.keyCode===27){$(g.currentTarget).find("form").trigger("reset")}});this.changeNarrator("Bart")};fleximeta.Narrator.prototype.addNarrator=function(f,g){this[f]=document.createElement("img");this[f].src="img/"+f+".png";this[f].className="simpson noselect";this[f].id=f;document.body.appendChild(this[f]);$(this[f]).popover({html:true,content:"",title:f+" says:",trigger:"manual",placement:g})};fleximeta.Narrator.prototype.changeNarrator=function(f){if(!this[f]){return}b=this[f]};fleximeta.Narrator.instance=undefined;fleximeta.Narrator.getInstance=function(){if(!fleximeta.Narrator.instance){fleximeta.Narrator.instance=new fleximeta.Narrator()}return fleximeta.Narrator.instance}})();(function(){fleximeta.Demo=function(){this.user=undefined;this.diagram=undefined;this.model=undefined;this.views={}};fleximeta.Demo.prototype.initialize=function(){this.initializeNarrator();this.initializeData()};fleximeta.Demo.prototype.reinitialize=function(a){this.phase=a;var b=this.canvas.save();var e=fleximeta.Serializer.serialize(this.model);fleximeta.model.Base.emptyCache();var d=fleximeta.Serializer.deserialize(JSON.parse(e),{baseClass:fleximeta.model.Family});for(var c in this.views){this.views[c].model=d;this.views[c].phase=a}this.views.modelExplorer.reinitialize(d);this.views.validation.reinitialize();this.views.xmlExporter.reinitialize();console.log(d);this.canvas.clear();this.canvas.model=d;delete this.model;this.model=d;this.canvas.load(this.diagram)};fleximeta.Demo.prototype.initializeViews=function(){var d=new fleximeta.views.JsonExporter({element:document.getElementById("jsonExporter"),model:this.model});var b=new fleximeta.views.XmlExporter({element:document.getElementById("xmlExporter"),model:this.model});var c=new fleximeta.views.Chart({element:document.getElementById("phase"),demo:this});var e=new fleximeta.views.ModelExplorer({element:document.getElementById("modelExplorer"),model:this.model});var a=new fleximeta.views.Validation({element:document.getElementById("validation"),phase:this.phase,model:this.model});this.views={jsonExporter:d,xmlExporter:b,chart:c,modelExplorer:e,validation:a}};fleximeta.Demo.prototype.initializeNarrator=function(){this.narrator=fleximeta.Narrator.getInstance();this.narrator.init()};fleximeta.Demo.prototype.initializeData=function(){var a=this;$.ajax({url:"/ajax/user/get",type:"GET",dataType:"json",success:function(b){a.user=b.user;a.diagram=b.diagram;a.phase=b.phase;a.initializeModel(b.model);a.initializeEditor();a.initializeViews();if(b.firstConnexion){fleximeta.Narrator.getInstance().showPresentationScenario(true)}}})};fleximeta.Demo.prototype.initializeScenario=function(){var a=this};fleximeta.Demo.prototype.initializeModel=function(a){this.model=fleximeta.Serializer.deserialize(a)};fleximeta.Demo.prototype.initializeEditor=function(){var b=document.getElementById("editor"),a=this.model;this.canvas=new fleximeta.editor.Canvas("editor",{width:b.offsetWidth,height:b.offsetHeight,renderOnAddRemove:false,backgroundColor:"white",model:this.model});this.canvas.load(this.diagram)};fleximeta.Demo.prototype.save=function(){var b=this.canvas.save(),a=fleximeta.Serializer.serialize(this.model);var c={model:a,diagram:JSON.stringify(b)};$.ajax({url:"/ajax/user/update",type:"POST",data:c,dataType:"json",success:function(d){console.log(d)}})}})();$(function(){var b=new fleximeta.Demo();b.initialize();$('[data-toggle="popover"]').popover();$.contextMenu({selector:".upper-canvas",build:function(c,f){var d=b.canvas.findTarget(f)||b.canvas;return{callback:function(g,e){var h=d.contextMenu[g].callback;d[h](f)},items:d.getContextMenu()}}});$(".navbar-toggle").click();var a=fleximeta.Narrator.getInstance();$("#privacy").bind("click",function(c){c.preventDefault();a.showPrivacy(true,function(){})});$("#save").bind("click",function(c){c.preventDefault();b.save()})});